{% extends "user/base.html" %}
{% load static %}

{% block title %}PetPal ‚Äì Premium Adoption{% endblock %}

{% block extra_css %}
<style>
*{margin:0;padding:0;box-sizing:border-box}

/* ===== PAGE BACKGROUND ===== */
body{
  background:linear-gradient(135deg,#eef1ff,#ffe6f5);
  overflow-x:hidden;
}

/* ===== BACKGROUND BLOBS ===== */
.blob{
  position:fixed;
  width:420px;height:420px;
  border-radius:50%;
  filter:blur(120px);
  opacity:.45;
  z-index:-1;
}
.blob.one{background:#818cf8;top:-120px;left:-120px}
.blob.two{background:#f472b6;bottom:-120px;right:-120px}

/* ===== GLASS ===== */
.glass{
  background:rgba(255,255,255,.8);
  backdrop-filter:blur(20px);
  border-radius:26px;
  border:1px solid rgba(255,255,255,.6);
}

/* ===== MODAL ===== */
.modal-bg{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}
.modal{
  background:white;
  padding:40px;
  border-radius:20px;
  width:90%;
  max-width:420px;
}

/* ================= ADOPT BUTTON PULSE ================= */
@keyframes pulseGlow{
  0%{ box-shadow:0 0 0 0 rgba(99,102,241,.6); }
  70%{ box-shadow:0 0 0 12px rgba(99,102,241,0); }
  100%{ box-shadow:0 0 0 0 rgba(99,102,241,0); }
}

.adopt-btn{
  animation:pulseGlow 2s infinite;
  position:relative;
}
.adopt-btn:hover{
  animation:none;
  box-shadow:0 10px 30px rgba(99,102,241,.55);
  transform:translateY(-2px);
}

/* ===== ALREADY REQUESTED BADGE ===== */
.requested-badge{
  position:absolute;
  top:16px;
  right:16px;
  background:rgba(34,197,94,.15);
  color:#16a34a;
  padding:6px 14px;
  border-radius:999px;
  font-size:13px;
  font-weight:700;
}
</style>
{% endblock %}

{% block content %}

<div class="blob one"></div>
<div class="blob two"></div>

<!-- HEADER -->
<div class="text-center mt-24 mb-16">
  <h1 class="text-6xl font-extrabold text-indigo-700">
    Find Your Forever Friend
  </h1>
  <p class="text-gray-600 text-lg mt-4">
    Premium care. Trusted adoption. Endless love.
  </p>
</div>

<!-- ================= LOGIN NOTICE ================= -->
{% if not request.session.user_id %}
<div class="max-w-4xl mx-auto mb-12 p-6 rounded-2xl bg-yellow-50 border border-yellow-200 text-yellow-800 text-center">
  <p class="text-lg font-semibold">You can browse pets without logging in.</p>
  <p class="mt-2">To adopt a pet, please log in first.</p>
  <a href="{% url 'petapp:login' %}"
     class="inline-block mt-4 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
    Login to Continue
  </a>
</div>
{% endif %}

<!-- PET GRID -->
<div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-12 px-6 md:px-20 pb-24">

{% for pet in pets %}
<div class="glass pet-card overflow-hidden relative">

  {% if pet.vaccinated %}
  <span class="absolute top-4 left-4 bg-green-600 text-white px-4 py-1 rounded-full text-sm shadow">
    ‚úî Vaccinated
  </span>
  {% endif %}

  {% if pet.id in requested_pets %}
  <span class="requested-badge">Already Requested</span>
  {% endif %}

  <div class="overflow-hidden rounded-t-3xl">
    <img src="{{ pet.image.url }}" class="w-full h-64 object-cover">
  </div>

  <div class="p-7">
    <h3 class="text-2xl font-bold">{{ pet.name }}</h3>

    <p class="text-gray-500 text-sm mt-1">
      {{ pet.pet_type }} ‚Ä¢ {{ pet.age }} Years
    </p>

    <div class="flex gap-4 mt-7">
      <a href="{% url 'petapp:petDetails' pet.id %}"
         class="w-1/2 py-3 text-center bg-indigo-50 border border-indigo-200 text-indigo-700 rounded-xl font-semibold">
        View
      </a>

      {% if pet.status != "available" %}
        <button disabled
          class="w-1/2 py-3 bg-gray-300 text-gray-600 rounded-xl font-semibold cursor-not-allowed">
          Locked
        </button>

      {% elif pet.id in requested_pets %}
        <button disabled
          class="w-1/2 py-3 bg-gray-300 text-gray-600 rounded-xl font-semibold cursor-not-allowed">
          Requested
        </button>

      {% else %}
        <button
          onclick="openAdoptModal('{{ pet.id }}')"
          class="adopt-btn w-1/2 py-3 text-center bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-semibold">
          Adopt
        </button>
      {% endif %}
    </div>
  </div>
</div>

{% empty %}
<p class="text-center col-span-3 text-gray-500 text-lg">
  No pets available for adoption right now üêæ
</p>
{% endfor %}

</div>

<!-- ================= MODAL ================= -->
<div id="adoptModal" class="modal-bg">
  <div class="modal">
    <h2 class="text-2xl font-bold mb-4 text-indigo-700">Select Adoption Date & Time</h2>

    <form method="POST" id="adoptForm">
      {% csrf_token %}

      <label class="block mb-2 font-semibold text-gray-700">Adoption Date</label>
      <input type="date" name="visit_date"
             class="w-full px-4 py-3 border rounded-xl mb-5" required>

      <label class="block mb-2 font-semibold text-gray-700">Preferred Time (10AM ‚Äì 10PM)</label>
      <select name="adoption_time"
              class="w-full px-4 py-3 border rounded-xl mb-6" required>
        <option value="">Select a time slot</option>
        {% for h in "10,11,12,13,14,15,16,17,18,19,20,21"|cut:"," %}
        {% endfor %}
      </select>

      <div class="flex justify-end gap-4">
        <button type="button" onclick="closeModal()"
                class="px-6 py-2 border rounded-xl">Cancel</button>
        <button type="submit"
                class="px-6 py-2 bg-indigo-600 text-white rounded-xl">
          Confirm Adoption
        </button>
      </div>
    </form>
  </div>
</div>

<script>
function openAdoptModal(petId){
    {% if not request.session.user_id %}
        alert("You must be logged in to adopt a pet.");
        window.location.href = "{% url 'petapp:login' %}";
        return;
    {% endif %}

    const modal = document.getElementById("adoptModal");
    const form = document.getElementById("adoptForm");

    form.action = "/adopt/" + petId + "/";
    modal.style.display = "flex";
}

function closeModal(){
    document.getElementById("adoptModal").style.display = "none";
}
</script>

{% endblock %}
