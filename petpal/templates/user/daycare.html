{% extends "user/base.html" %}
{% load static %}

{% block title %}PetPal — Daycare{% endblock %}

{% block extra_css %}
<style>
.paw-bg{
  position:fixed;
  inset:0;
  background-image:url("{% static 'img/paws4.jpeg' %}");
  background-size:90px;
  opacity:.25;
  animation:paws 70s linear infinite;
  pointer-events:none;
  z-index:-1;
}
@keyframes paws{
  from{background-position:0 0}
  to{background-position:1400px 1400px}
}

/* ===== CARDS ===== */
.card{
  background:white;
  border-radius:24px;
  box-shadow:0 30px 70px rgba(0,0,0,.08);
}
.dark .card{
  background:rgba(30,41,59,.85);
  box-shadow:0 30px 70px rgba(0,0,0,.6);
  border:1px solid rgba(255,255,255,.08);
}

/* ===== PLANS ===== */
.plan{
  cursor:pointer;
  transition:.35s;
}
.plan:hover{transform:translateY(-8px)}
.plan.active{
  border:2px solid #ec4899;
  box-shadow:0 30px 80px rgba(236,72,153,.35);
}

/* ===== INPUTS ===== */
.input{
  width:100%;
  padding:16px;
  border-radius:16px;
  border:1.5px solid #e5e7eb;
  background:#fff;
  color:#111827;
}
.input:focus{
  outline:none;
  border-color:#ec4899;
  box-shadow:0 0 0 4px rgba(236,72,153,.2);
}
.dark .input{
  background:#0f172a;
  border-color:#334155;
  color:#f1f5f9;
}

/* ===== SUMMARY ===== */
.summary{
  background:linear-gradient(135deg,#fff1f8,#eef2ff);
  border-radius:24px;
  padding:28px;
}
.dark .summary{
  background:linear-gradient(135deg,#1e293b,#0f172a);
  border:1px solid rgba(255,255,255,.08);
}
.total{
  font-size:1.6rem;
  font-weight:800;
  color:#ec4899;
}

/* ===== CLOCK TIME PICKER ===== */
.time-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(90px,1fr));
  gap:12px;
}
.time-btn{
  padding:10px 0;
  border-radius:12px;
  background:#f8fafc;
  border:1px solid #e5e7eb;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}
.time-btn:hover{background:#fde2f3;}
.time-btn.active{
  background:#ec4899;
  color:white;
  border-color:#ec4899;
}

/* ===== MOBILE ===== */
@media(max-width:768px){
  .hero-video{display:none;}
}
</style>
{% endblock %}

{% block content %}

<div class="paw-bg"></div>

<!-- HERO -->
<section class="relative h-[85vh] overflow-hidden">
  <video autoplay muted loop playsinline
    class="hero-video absolute inset-0 w-full h-full object-cover">
    <source src="{% static 'img/daycare.mp4' %}" type="video/mp4">
  </video>
  <div class="absolute inset-0 bg-black/45"></div>
</section>

<!-- PLANS -->
<section id="plans" class="max-w-7xl mx-auto px-6 mt-32 space-y-16">
<h2 class="text-4xl font-extrabold text-center">Choose a Daycare Plan</h2>

<div class="grid md:grid-cols-3 gap-10">
  <div class="card plan p-10" onclick="selectPlan('Basic',this)">
    <h3 class="text-xl font-bold mb-3">Basic</h3>
    <p class="text-4xl font-extrabold mb-6">₹499</p>
  </div>

  <div class="card plan p-10 active" onclick="selectPlan('Standard',this)">
    <h3 class="text-xl font-bold mb-3">Standard</h3>
    <p class="text-4xl font-extrabold mb-6">₹899</p>
  </div>

  <div class="card plan p-10" onclick="selectPlan('Premium',this)">
    <h3 class="text-xl font-bold mb-3">Premium</h3>
    <p class="text-4xl font-extrabold mb-6">₹1499</p>
  </div>
</div>

<!-- =================== SINGLE FORM =================== -->
<form method="POST" action="{% url 'petapp:confirmbook' %}">
{% csrf_token %}

<!-- DETAILS -->
<div class="card p-12 max-w-4xl mx-auto mt-24">
  <h3 class="text-3xl font-extrabold mb-8 text-center">Pet & Owner Details</h3>

  <div class="grid md:grid-cols-2 gap-6">

    <input class="input" name="pet_name" id="pet_name"
      placeholder="Your pet’s name (e.g., Bruno, Luna)" required>

    <select class="input" id="petType" name="pet_type" onchange="toggleOtherAnimal()">
      <option value="Dog">Dog</option>
      <option value="Cat">Cat</option>
      <option value="Other">Other</option>
    </select>

    <!-- OTHER ANIMAL FIELD -->
    <input class="input md:col-span-2 hidden" id="otherAnimal"
      name="other_animal"
      placeholder="Please specify the animal (e.g., Rabbit, Parrot)">

    <input class="input" type="number" name="pet_age"
      placeholder="Pet age in years (e.g., 2)" min="0">

    <input class="input" name="owner_name"
      placeholder="Your full name" required>

    <input class="input" type="tel" name="phone"
      placeholder="Contact number" required>

    <input class="input md:col-span-2" type="email" name="email"
      placeholder="Email for booking updates" required>

    <input class="input md:col-span-2" type="date" name="date" id="date" required>

    <select class="input md:col-span-2" id="duration" name="duration" onchange="updatePrice()">
      <option value="half">Half Day</option>
      <option value="full" selected>Full Day</option>
      <option value="overnight">Overnight</option>
    </select>

  </div>

  <!-- CLOCK TIME PICKER -->
  <div class="mt-10">
    <label class="block text-sm font-medium mb-3">Choose Drop-off Time</label>
    <div class="time-grid" id="timeGrid"></div>
    <p class="text-xs text-gray-400 mt-3">Available between 10:00 AM – 10:00 PM</p>
  </div>
</div>

<!-- SUMMARY -->
<div class="summary max-w-xl mx-auto mt-16 text-center">
  <p class="text-gray-600 mb-2">Selected Plan</p>
  <h3 class="text-xl font-bold mb-2" id="planName">Standard</h3>
  <p class="text-gray-500 mb-4" id="durationName">Full Day</p>

  <p class="text-gray-600">Total Amount</p>
  <div class="total mb-6">₹<span id="total">899</span></div>

  <input type="hidden" name="plan" id="plan_input">
  <input type="hidden" name="total_cost" id="total_cost_input">
  <input type="hidden" name="start_time" id="start_time">
  <input type="hidden" name="end_time" id="end_time">

  <button type="submit"
    class="block w-full py-4 bg-pink-600 hover:bg-pink-700 text-white rounded-xl font-semibold">
    Confirm Booking
  </button>
</div>

</form>
</section>
{% endblock %}

{% block extra_js %}
<script>
let selectedPlan = "Standard";
let selectedTime = "";

const prices = {
  Basic: { half: 299, full: 499, overnight: 799 },
  Standard: { half: 499, full: 899, overnight: 1299 },
  Premium: { half: 799, full: 1499, overnight: 1999 }
};

function selectPlan(plan, el){
  selectedPlan = plan;
  document.querySelectorAll('.plan').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  updatePrice();
}

function updatePrice(){
  const duration = document.getElementById("duration").value;
  document.getElementById("planName").textContent = selectedPlan;
  document.getElementById("durationName").textContent = duration.toUpperCase();
  document.getElementById("total").textContent = prices[selectedPlan][duration];
}

/* SHOW OTHER ANIMAL FIELD */
function toggleOtherAnimal(){
  const type = document.getElementById("petType").value;
  document.getElementById("otherAnimal").classList.toggle("hidden", type !== "Other");
}

/* TIME PICKER */
const timeGrid = document.getElementById("timeGrid");
for(let h=10; h<=21; h++){
  ["00","30"].forEach(m=>{
    const t = `${h.toString().padStart(2,"0")}:${m}`;
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "time-btn";
    btn.textContent = t;
    btn.onclick = ()=>selectTime(t, btn);
    timeGrid.appendChild(btn);
  });
}
const lastBtn = document.createElement("button");
lastBtn.type = "button";
lastBtn.className = "time-btn";
lastBtn.textContent = "22:00";
lastBtn.onclick = ()=>selectTime("22:00", lastBtn);
timeGrid.appendChild(lastBtn);

function selectTime(time, el){
  selectedTime = time;
  document.querySelectorAll(".time-btn").forEach(b=>b.classList.remove("active"));
  el.classList.add("active");
  document.getElementById("start_time").value = time;
  document.getElementById("end_time").value = time;
}

/* SUBMIT VALIDATION */
document.querySelector("form").addEventListener("submit", function(e){
  const date = document.getElementById("date").value;
  if(!date || !selectedTime){
    alert("Please select date and time.");
    e.preventDefault();
    return;
  }
  document.getElementById("plan_input").value = selectedPlan;
  document.getElementById("total_cost_input").value = document.getElementById("total").textContent;
});
</script>
{% endblock %}
