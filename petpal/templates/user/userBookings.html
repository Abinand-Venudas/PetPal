{% extends "user/base.html" %}
{% load static %}

{% block title %}My Activity ‚Äî PetPal{% endblock %}

{% block extra_css %}
<style>
/* ================= THEME VARIABLES ================= */
:root{
  --bg-main:#f4f6ff;
  --bg-card:#ffffff;
  --text-main:#0f172a;
  --text-sub:#64748b;
  --border:#e5e7eb;
  --soft:#f8fafc;
  --grad:linear-gradient(135deg,#6366f1,#ec4899);
}

.dark{
  --bg-main:#0b1220;
  --bg-card:#0f172a;
  --text-main:#f9fafb;
  --text-sub:#94a3b8;
  --border:#1e293b;
  --soft:#020617;
  --grad:linear-gradient(135deg,#4f46e5,#db2777);
}

/* ================= LAYOUT ================= */
.page-wrap{
  max-width:1300px;
  margin:auto;
  padding:70px 24px;
  background:var(--bg-main);
}

/* ================= HEADER ================= */
.page-header{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-bottom:50px;
}

.page-title{
  font-size:2.6rem;
  font-weight:900;
  color:var(--text-main);
}

.page-sub{
  color:var(--text-sub);
  font-size:1rem;
}

/* ================= SECTION ================= */
.section{
  margin-bottom:60px;
}

.section-title{
  font-size:1.6rem;
  font-weight:900;
  margin-bottom:24px;
  color:var(--text-main);
  display:flex;
  align-items:center;
  gap:10px;
}

.section-title span{
  font-size:.8rem;
  padding:6px 12px;
  border-radius:999px;
  background:var(--soft);
  border:1px solid var(--border);
  color:var(--text-sub);
}

/* ================= GRID ================= */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
  gap:24px;
}

/* ================= CARD ================= */
.card{
  background:var(--bg-card);
  border-radius:20px;
  padding:22px 24px;
  border:1px solid var(--border);
  box-shadow:0 10px 35px rgba(0,0,0,.08);
  transition:.25s;
  position:relative;
  overflow:hidden;
}
.card:hover{
  transform:translateY(-4px);
  box-shadow:0 20px 50px rgba(0,0,0,.15);
}

/* ================= CARD HEADER ================= */
.card-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:14px;
}

.card-title{
  font-weight:900;
  font-size:1.1rem;
  color:var(--text-main);
}

/* ================= STATUS ================= */
.status{
  padding:6px 14px;
  border-radius:999px;
  font-size:.7rem;
  font-weight:900;
}

.success{background:#dcfce7;color:#166534;}
.pending{background:#fef9c3;color:#854d0e;}
.cancel{background:#fee2e2;color:#991b1b;}

.dark .success{background:#064e3b;color:#6ee7b7;}
.dark .pending{background:#78350f;color:#fde68a;}
.dark .cancel{background:#3f1d1d;color:#fecaca;}

/* ================= BODY ================= */
.info{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px 18px;
  font-size:.9rem;
}

.label{
  font-weight:700;
  color:var(--text-sub);
  font-size:.75rem;
  text-transform:uppercase;
}

.value{
  font-weight:800;
  color:var(--text-main);
}

/* ================= EMPTY ================= */
.empty{
  padding:30px;
  border-radius:16px;
  background:var(--soft);
  border:1px solid var(--border);
  text-align:center;
  color:var(--text-sub);
  font-weight:600;
}

.btn{
  padding:10px 18px;
  border-radius:12px;
  font-weight:800;
  text-decoration:none;
  font-size:.75rem;
  transition:.25s;
}

.btn-primary{
  background:var(--grad);
  color:white;
}

.btn-secondary{
  background:var(--soft);
  border:1px solid var(--border);
  color:var(--text-main);
}

.btn-danger{
  background:#fee2e2;
  color:#991b1b;
  border:1px solid #fecaca;
}

.dark .btn-danger{
  background:#3f1d1d;
  color:#fecaca;
  border:1px solid #7f1d1d;
}

.btn:hover{
  transform:translateY(-2px);
}

</style>
{% endblock %}

{% block content %}
<section class="page-wrap">

<div class="page-header">
  <div class="page-title">My Activity</div>
  <div class="page-sub">All your bookings, services and history in one place</div>
</div>

<!-- ================= CONSULTATIONS ================= -->
<div class="section">
  <div class="section-title">Consultations <span>{{ bookings|length }}</span></div>

  {% if bookings %}
  <div class="cards">
    {% for b in bookings %}
    <div class="card">
      <div class="card-head">
        <div class="card-title">{{ b.doctor.name }}</div>
        <div class="status 
          {% if b.status == 'Approved' %}success
          {% elif b.status == 'pending' or b.status == 'Pending' %}pending
          {% else %}cancel{% endif %}">
          {{ b.status|upper }}
        </div>
      </div>

      <div class="info">
        <div>
          <div class="label">Date</div>
          <div class="value">{{ b.date }}</div>
        </div>
        <div>
          <div class="label">Time</div>
          <div class="value">{{ b.time }}</div>
        </div>
        <div>
          <div class="label">Issue</div>
          <div class="value">{{ b.reason|default:"General Consultation"|truncatechars:25 }}</div>
        </div>
        <div>
          <div class="label">Type</div>
          <div class="value">Consultation</div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="empty">No consultations booked yet</div>
  {% endif %}
</div>

<!-- ================= DAYCARE ================= -->
<div class="section">
  <div class="section-title">Daycare <span>{{ daycare_bookings|length }}</span></div>

  {% if daycare_bookings %}
  <div class="cards">
    {% for d in daycare_bookings %}
    <div class="card">
      <div class="card-head">
        <div class="card-title">{{ d.pet_name }}</div>
        <div class="status 
          {% if d.status == 'Confirmed' %}success
          {% elif d.status == 'Pending' %}pending
          {% else %}cancel{% endif %}">
          {{ d.status|upper }}
        </div>
      </div>

      <div class="info">
        <div>
          <div class="label">Date</div>
          <div class="value">{{ d.date }}</div>
        </div>
        <div>
          <div class="label">Plan</div>
          <div class="value">{{ d.plan }}</div>
        </div>
        <div>
          <div class="label">Duration</div>
          <div class="value">{{ d.duration }}</div>
        </div>
        <div>
          <div class="label">Total</div>
          <div class="value">‚Çπ{{ d.total_cost }}</div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="empty">No daycare bookings yet</div>
  {% endif %}
</div>

<!-- ================= GROOMING ================= -->
<div class="section">
  <div class="section-title">Grooming <span>{{ grooming_bookings|length }}</span></div>

  {% if grooming_bookings %}
  <div class="cards">
    {% for g in grooming_bookings %}
    <div class="card">
      <div class="card-head">
        <div class="card-title">{{ g.pet_name }}</div>
        <div class="status 
          {% if g.status == 'Cancelled' %}cancel
          {% elif g.status == 'Completed' %}success
          {% else %}pending{% endif %}">
          {{ g.status|upper }}
        </div>
      </div>

      <div class="info">
        <div>
          <div class="label">Date</div>
          <div class="value">{{ g.date }}</div>
        </div>
        <div>
          <div class="label">Time</div>
          <div class="value">{{ g.start_time }} - {{ g.end_time }}</div>
        </div>
        <div>
          <div class="label">Guardian</div>
          <div class="value">{{ g.guardian_name }}</div>
        </div>
        <div>
          <div class="label">Total</div>
          <div class="value">‚Çπ{{ g.total }}</div>
        </div>
      </div>

      <!-- ACTIONS -->
      <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap;">
        <a href="{% url 'petapp:grooming_invoice' g.id %}" class="btn btn-secondary">
          üìÑ Invoice
        </a>

        {% if g.status != 'Cancelled' and g.status != 'Completed' %}
        <a href="{% url 'petapp:cancel_grooming' g.id %}" class="btn btn-danger">
          ‚ùå Cancel
        </a>
        {% endif %}
<a href="{% url 'petapp:rebook_grooming' g.id %}" class="btn btn-primary">
  Rebook
</a>

      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="empty">No grooming bookings yet</div>
  {% endif %}
</div>


</section>
{% endblock %}
