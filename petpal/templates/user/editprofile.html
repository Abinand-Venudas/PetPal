{% extends "user/base.html" %}
{% block title %}Edit Profile | Pawfect{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto mt-24 px-4">

  <div class="bg-white dark:bg-slate-900/90 backdrop-blur-xl 
              p-10 rounded-3xl shadow-2xl 
              border border-gray-200 dark:border-slate-700
              dark:shadow-[0_0_0_1px_rgba(99,102,241,0.15)]">

    <!-- Header -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-2">
        <div class="w-10 h-10 flex items-center justify-center rounded-xl 
                    bg-indigo-100 dark:bg-indigo-500/10 
                    text-indigo-600 dark:text-indigo-400">
          <i class="fas fa-user-edit"></i>
        </div>
        <h2 class="text-3xl font-extrabold text-indigo-600 dark:text-indigo-400">
          Edit Profile
        </h2>
      </div>
      <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
        Update your personal information below.
      </p>
    </div>

    <!-- SUCCESS MESSAGE -->
    {% if messages %}
      {% for message in messages %}
        <div class="mb-6 px-5 py-3 rounded-xl text-sm font-semibold
                    {% if message.tags == 'success' %}
                    bg-green-100 text-green-700 dark:bg-green-500/10 dark:text-green-400
                    {% else %}
                    bg-red-100 text-red-700 dark:bg-red-500/10 dark:text-red-400
                    {% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- Form -->
    <form method="POST" enctype="multipart/form-data" class="space-y-6">
      {% csrf_token %}

      <!-- Profile Picture -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
          Profile Picture
        </label>
        <div class="flex items-center gap-4">
          <div class="w-16 h-16 rounded-full bg-gradient-to-br from-indigo-500 to-pink-500 
                      flex items-center justify-center text-white text-xl font-bold shadow-lg">
            {{ user.name|slice:":1" }}
          </div>
          <input type="file" name="profile_image"
                 class="block w-full text-sm text-gray-600 dark:text-gray-300
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-indigo-50 file:text-indigo-700
                        dark:file:bg-slate-800 dark:file:text-indigo-400
                        hover:file:bg-indigo-100 dark:hover:file:bg-slate-700">
        </div>
      </div>

      <!-- Full Name -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">
          Full Name
        </label>
        <input
          type="text"
          name="name"
          value="{{ user.name }}"
          required
          class="w-full mt-2 px-4 py-3 rounded-xl border border-gray-300 dark:border-slate-600 
                 bg-white dark:bg-slate-800 
                 text-gray-900 dark:text-gray-100
                 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition"
        >
      </div>

      <!-- Email -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">
          Email Address
        </label>
        <input
          type="email"
          name="email"
          value="{{ user.email }}"
          required
          class="w-full mt-2 px-4 py-3 rounded-xl border border-gray-300 dark:border-slate-600 
                 bg-white dark:bg-slate-800 
                 text-gray-900 dark:text-gray-100
                 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition"
        >
      </div>

      <!-- Password -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">
          New Password (optional)
        </label>
        <input
          type="password"
          id="password"
          name="password"
          oninput="checkStrength()"
          class="w-full mt-2 px-4 py-3 rounded-xl border border-gray-300 dark:border-slate-600 
                 bg-white dark:bg-slate-800 
                 text-gray-900 dark:text-gray-100
                 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition"
          placeholder="Leave blank to keep current password"
        >
        <p id="strengthText" class="mt-2 text-sm font-semibold"></p>
      </div>

      <!-- Divider -->
      <div class="pt-4 border-t border-gray-200 dark:border-slate-700"></div>

      <!-- Actions -->
      <div class="flex flex-col sm:flex-row gap-4">
        <button type="submit"
          class="flex-1 py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-pink-500 
                 text-white font-semibold shadow-lg 
                 hover:from-indigo-700 hover:to-pink-600 
                 focus:ring-2 focus:ring-indigo-400 transition transform hover:-translate-y-[1px]">
          ðŸ’¾ Save Changes
        </button>

        <a href="{% url 'petapp:profile' %}"
          class="flex-1 py-3 rounded-xl border border-gray-300 dark:border-slate-600
                 text-center font-semibold text-gray-700 dark:text-gray-200
                 hover:bg-gray-100 dark:hover:bg-slate-800 transition">
          Cancel
        </a>
      </div>
    </form>

  </div>
</div>

<!-- PASSWORD STRENGTH SCRIPT -->
<script>
function checkStrength(){
  const pwd = document.getElementById("password").value;
  const strengthText = document.getElementById("strengthText");

  if(pwd.length === 0){
    strengthText.textContent = "";
    return;
  }

  if(pwd.length < 6){
    strengthText.textContent = "Weak password";
    strengthText.className = "mt-2 text-sm font-semibold text-red-500";
  }
  else if(/[A-Z]/.test(pwd) && /\d/.test(pwd)){
    strengthText.textContent = "Strong password";
    strengthText.className = "mt-2 text-sm font-semibold text-green-500";
  }
  else{
    strengthText.textContent = "Medium strength";
    strengthText.className = "mt-2 text-sm font-semibold text-yellow-500";
  }
}
</script>

{% endblock %}
